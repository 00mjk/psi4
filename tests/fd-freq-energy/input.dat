#! SCF STO-3G finite-difference frequencies from energies
import numpy as np

molecule h2o {
  symmetry c1
  O
  H 1 0.9894093
  H 1 0.9894093 2 100.02688
}

set {
  basis sto-3g
  d_convergence 11
  scf_type pk
}

# Test against Analytic second derivatives from PSI4. #TEST
anal_freqs = np.array([2170.0460, 4140.0021, 4391.0669]) # TEST

# Frequencies by 3-pt formula in C1 point group.
set { points 3 }
set findif {print 3}

scf_e, scf_wfn = frequencies('scf', dertype=0, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                              #TEST
compare_arrays(anal_freqs, fd_freqs, 1,                                                  #TEST
 "Analytic vs. Finite-difference (3-pt.) frequencies from energies to 0.1 cm^-1 (C1) ")  #TEST


# Frequencies by 5-pt formula in C1 point group.
set { points 5 }


scf_e, scf_wfn = frequencies('scf', dertype=0, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                               #TEST
compare_arrays(anal_freqs, fd_freqs, 3,                                                   #TEST
 "Analytic vs. Finite-difference (5-pt.) frequencies from energies to 0.001 cm^-1 (C1) ") #TEST

clean()

# Frequencies by 3-pt formula in C2v.
molecule h2o {
  O
  H 1 0.9894093
  H 1 0.9894093 2 100.02688
}

set { points 3 }

scf_e, scf_wfn = frequencies('scf', dertype=0, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                              #TEST
compare_arrays(anal_freqs, fd_freqs, 1,                                                  #TEST
 "Analytic vs. Finite-difference (3-pt.) frequencies from energies to 0.1 cm^-1 (C2v) ") #TEST

# Frequencies by 5-pt formula in C2v.
set { points 5 }

scf_e, scf_wfn = frequencies('scf', dertype=0, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                                #TEST
compare_arrays(anal_freqs, fd_freqs, 3,                                                    #TEST
 "Analytic vs. Finite-difference (5-pt.) frequencies from energies to 0.001 cm^-1 (C2v) ") #TEST

# Frequencies by 5-pt formula for A1 irrep only.
molecule h2o {
  O
  H 1 0.9894093
  H 1 0.9894093 2 100.02688
}

set { points 5 }

a1_freqs = anal_freqs[:2]          #TEST

scf_e, scf_wfn = frequencies('scf', dertype=0, irrep=1, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                  #TEST
compare_arrays(a1_freqs, fd_freqs, 3, "A1 frequencies only (5-pt. formula)") #TEST

del a1_freqs #TEST

clean()

# Frequencies by 5-pt formula for B2 irrep only.
set { points 5 }

b2_freqs = anal_freqs[2:]       #TEST

scf_e, scf_wfn = frequencies('scf', dertype=0, irrep=4, return_wfn=True)

fd_freqs = scf_wfn.frequencies().to_array()                                  #TEST
compare_arrays(b2_freqs, fd_freqs, 3, "B2 frequencies only (5-pt. formula)") #TEST

del b2_freqs   #TEST
del anal_freqs #TEST
clean()

